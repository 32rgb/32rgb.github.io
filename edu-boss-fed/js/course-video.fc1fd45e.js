(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["course-video"],{"0289":function(e,t,r){"use strict";r.d(t,"d",(function(){return o})),r.d(t,"e",(function(){return a})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return u})),r.d(t,"a",(function(){return c}));var n=r("b775"),o=function(e){return Object(n["a"])({method:"get",url:"/boss/course/section/getSectionAndLesson",params:{courseId:e}})},a=function(e){return Object(n["a"])({method:"get",url:"/boss/course/section/getBySectionId",params:{sectionId:e}})},s=function(e){return Object(n["a"])({method:"post",url:"/boss/course/section/saveOrUpdateSection",data:e})},u=function(e){return Object(n["a"])({method:"get",url:"/boss/course/lesson/getById",params:{lessonId:e}})},c=function(e){return Object(n["a"])({method:"post",url:"/boss/course/lesson/saveOrUpdate",data:e})}},"1f26":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"course-video"},[r("el-page-header",{attrs:{content:"上传视频"},on:{back:e.goBack}}),r("div",{staticStyle:{width:"50%",margin:"0 auto"}},[r("el-form",{attrs:{"label-width":"120px"}},[r("el-form-item",{attrs:{label:"课程"}},[r("el-input",{attrs:{size:"medium",disabled:""},model:{value:e.course.courseName,callback:function(t){e.$set(e.course,"courseName",t)},expression:"course.courseName"}})],1),r("el-form-item",{attrs:{label:"课时"}},[r("el-input",{attrs:{size:"medium",disabled:""},model:{value:e.lesson.theme,callback:function(t){e.$set(e.lesson,"theme",t)},expression:"lesson.theme"}})],1),r("el-form-item",{attrs:{label:"视频上传"}},[r("input",{ref:"video-file",attrs:{type:"file"}})]),r("el-form-item",{attrs:{label:"封面上传"}},[r("input",{ref:"image-file",attrs:{type:"file"}})]),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.handleUpload}},[e._v("开始上传")])],1),r("el-form-item",[0!==e.uploadPercent?r("p",[e._v("视频上传中："+e._s(e.uploadPercent)+"%")]):e._e(),e.isUploadSuccess?r("p",[e._v("视频转码中 "+e._s(e.isTranscodeSuccess?"转码完成":"转码中..."))]):e._e()])],1)],1)],1)},o=[],a=r("1da1"),s=(r("96cf"),r("a9e3"),r("b0c0"),r("3042")),u=r("0289"),c=r("b775"),i=function(){return Object(c["a"])({method:"get",url:"/boss/course/upload/aliyunImagUploadAddressAdnAuth.json"})},d=function(e){return Object(c["a"])({method:"get",url:"/boss/course/upload/aliyunVideoUploadAddressAdnAuth.json",params:e})},l=function(e){return Object(c["a"])({method:"post",url:"/boss/course/upload/aliyunTransCode.json",data:e})},f=function(e){return Object(c["a"])({method:"get",url:"/boss/course/upload/aliyunTransCodePercent.json",params:{lessonId:e}})},p={name:"CourseVideo",props:{courseId:{type:[Number,String],required:!0},lessonId:{type:[Number,String]}},data:function(){return{course:{},lesson:{},uploader:null,imageURL:"",videoId:"",uploadPercent:0,isUploadSuccess:!1,isTranscodeSuccess:!1}},created:function(){this.loadCourseInfo(),this.loadLessonInfo(),this.initUploader()},methods:{loadCourseInfo:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(s["b"])(e.courseId);case 2:r=t.sent,n=r.data,"000000"===n.code&&(e.course=n.data);case 5:case"end":return t.stop()}}),t)})))()},loadLessonInfo:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(u["c"])(e.lessonId);case 2:r=t.sent,n=r.data,"000000"===n.code&&(e.lesson=n.data);case 5:case"end":return t.stop()}}),t)})))()},initUploader:function(){var e=this;this.uploader=new window.AliyunUpload.Vod({userId:"1618139964448548",region:"",partSize:1048576,parallel:5,retryCount:3,retryDuration:2,onUploadstarted:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(r){var n,o,a,s,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=null,!r.isImage){t.next=9;break}return t.next=4,i();case 4:o=t.sent,a=o.data,"000000"===a.code&&(n=a.data,e.imageURL=n.imageURL),t.next=14;break;case 9:return t.next=11,d({fileName:r.file.name,imageUrl:e.imageURL});case 11:s=t.sent,u=s.data,"000000"===u.code&&(n=u.data,e.videoId=u.data.videoId);case 14:e.uploader.setUploadAuthAndAddress(r,n.uploadAuth,n.uploadAddress,n.imageId||n.videoId);case 15:case"end":return t.stop()}}),t)})));function r(e){return t.apply(this,arguments)}return r}(),onUploadSucceed:function(e){},onUploadFailed:function(e,t,r){},onUploadProgress:function(t,r,n){t.isImage||(e.uploadPercent=Math.floor(100*n))},onUploadTokenExpired:function(e){},onUploadEnd:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(r){var n,o,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isUploadSuccess=!0,t.next=3,l({lessonId:e.lessonId,coverImageUrl:e.imageURL,fileId:e.videoId,fileName:e.$refs["video-file"].files[0].name});case 3:n=t.sent,o=n.data,"000000"===o.code&&(s=setInterval(Object(a["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,f(e.lessonId);case 2:r=t.sent,n=r.data,"000000"===n.code&&100===n.data&&(e.isTranscodeSuccess=!0,e.$message.success("视频转码成功"),clearInterval(s));case 5:case"end":return t.stop()}}),t)}))),1e3));case 6:case"end":return t.stop()}}),t)})));function r(e){return t.apply(this,arguments)}return r}()})},handleUpload:function(){var e=this.$refs["video-file"].files[0],t=this.$refs["image-file"].files[0],r=this.uploader;r.addFile(t),r.addFile(e),r.startUpload()},goBack:function(){this.$router.push({name:"course-sections",params:{courseId:this.courseId}})}}},m=p,b=(r("a5ff"),r("2877")),h=Object(b["a"])(m,n,o,!1,null,"73b25482",null);t["default"]=h.exports},3042:function(e,t,r){"use strict";r.d(t,"c",(function(){return o})),r.d(t,"a",(function(){return a})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return u})),r.d(t,"b",(function(){return c}));var n=r("b775"),o=function(e){return Object(n["a"])({method:"post",url:"/boss/course/getQueryCourses",data:e})},a=function(e){return Object(n["a"])({method:"get",url:"/boss/course/changeState",params:e})},s=function(e){return Object(n["a"])({method:"post",url:"/boss/course/saveOrUpdateCourse",data:e})},u=function(e,t){return Object(n["a"])({method:"post",url:"/boss/course/upload",data:e,onUploadProgress:t})},c=function(e){return Object(n["a"])({method:"get",url:"/boss/course/getCourseById",params:{courseId:e}})}},"408a":function(e,t){var r=1..valueOf;e.exports=function(e){return r.call(e)}},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,r){var n=r("1d80"),o=r("577e"),a=r("5899"),s="["+a+"]",u=RegExp("^"+s+s+"*"),c=RegExp(s+s+"*$"),i=function(e){return function(t){var r=o(n(t));return 1&e&&(r=r.replace(u,"")),2&e&&(r=r.replace(c,"")),r}};e.exports={start:i(1),end:i(2),trim:i(3)}},7156:function(e,t,r){var n=r("1626"),o=r("861d"),a=r("d2bb");e.exports=function(e,t,r){var s,u;return a&&n(s=t.constructor)&&s!==r&&o(u=s.prototype)&&u!==r.prototype&&a(e,u),e}},a5ff:function(e,t,r){"use strict";r("f2da")},a9e3:function(e,t,r){"use strict";var n=r("83ab"),o=r("da84"),a=r("94ca"),s=r("6eeb"),u=r("1a2d"),c=r("7156"),i=r("d9b5"),d=r("c04e"),l=r("d039"),f=r("241c").f,p=r("06cf").f,m=r("9bf2").f,b=r("408a"),h=r("58a8").trim,g="Number",v=o[g],I=v.prototype,U=function(e){var t=d(e,"number");return"bigint"===typeof t?t:y(t)},y=function(e){var t,r,n,o,a,s,u,c,l=d(e,"number");if(i(l))throw TypeError("Cannot convert a Symbol value to a number");if("string"==typeof l&&l.length>2)if(l=h(l),t=l.charCodeAt(0),43===t||45===t){if(r=l.charCodeAt(2),88===r||120===r)return NaN}else if(48===t){switch(l.charCodeAt(1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+l}for(a=l.slice(2),s=a.length,u=0;u<s;u++)if(c=a.charCodeAt(u),c<48||c>o)return NaN;return parseInt(a,n)}return+l};if(a(g,!v(" 0o1")||!v("0b1")||v("+0x1"))){for(var O,w=function(e){var t=arguments.length<1?0:v(U(e)),r=this;return r instanceof w&&l((function(){b(r)}))?c(Object(t),r,w):t},j=n?f(v):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),N=0;j.length>N;N++)u(v,O=j[N])&&!u(w,O)&&m(w,O,p(v,O));w.prototype=I,I.constructor=w,s(o,g,w)}},b0c0:function(e,t,r){var n=r("83ab"),o=r("5e77").EXISTS,a=r("9bf2").f,s=Function.prototype,u=s.toString,c=/^\s*function ([^ (]*)/,i="name";n&&!o&&a(s,i,{configurable:!0,get:function(){try{return u.call(this).match(c)[1]}catch(e){return""}}})},f2da:function(e,t,r){}}]);
//# sourceMappingURL=course-video.fc1fd45e.js.map